<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@a5a8449/dist/aframe-particle-system-component.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-simple-sun-sky@^1.2.2/simple-sun-sky.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@d5f3f8/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.7/dist/aframe-environment-component.min.js"></script>

    <title>Mars</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <!-- Ctrl alt i pour l'inspecteur -->
    <a-scene inspector-plugin-recast>
      <a-assets>
        <a-asset-item id="Rover" src="./assets/mars_rover_2.glb"></a-asset-item>
        <a-asset-item id="scene" src="./assets/mars_base.glb"></a-asset-item>
        <a-asset-item id="rock" src="./assets/desert_rock_base.glb"></a-asset-item>
        <a-asset-item id="robot" src="./assets/robot.glb"></a-asset-item>
        <a-asset-item id="montagne" src="./assets/mountains.glb"></a-asset-item>
        <a-asset-item id="cliff" src="./assets/desert_cliff_6.glb"></a-asset-item>
        <a-asset-item id="canyon" src="./assets/red_sand_desert_canyon.glb"></a-asset-item>

        <img id="sky" src="./assets/textures/sky2.webp" />
        <audio id="audio" src="./assets/Crossing_Mars.mp3" controls></audio>
      </a-assets>

      <a-sky src="#sky" rotation="0 45 0"></a-sky>

      <a-entity id="rig" movement-controls position="0 0 0">
        <a-entity
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true"
          cursor="rayOrigin: mouse" 
        >
          <a-cursor
            color="red"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: red; shader: flat"
            animation__click="property: scale; startEvents: click; from: 1 1 1; to: 0.5 0.5 0.5; dur: 150"
            animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 1.5 1.5 1.5; dur: 1500"
          ></a-cursor>
        </a-entity>
        <a-entity
          oculus-touch-controls="hand: left"
          laser-controls="hand: left"
          raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-entity>
        <a-entity
          oculus-touch-controls="hand: right"
          laser-controls="hand: right"
          raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-entity>
      </a-entity>

      <a-entity
        particle-system="preset: dust; color: #C2B280; particleCount: 50000; texture: ./assets/textures/red_sand.jpg; size: .2; velocityValue: -50 0 50; velocitySpread: 50 0 10;"
        position="-41.525 15 10"
      ></a-entity>
      <a-entity
        particle-system="preset: dust; color: #C2B280; particleCount: 50000; texture: ./assets/textures/red_sand.jpg; size: .2; velocityValue: -50 0 50; velocitySpread: 50 0 10;"
        position="-41.525 15 -50"
      ></a-entity>
      <a-entity
        particle-system="preset: dust; color: #C2B280; particleCount: 50000; texture: ./assets/textures/red_sand.jpg; size: .2; velocityValue: -50 0 50; velocitySpread: 50 0 10;"
        position="-41.525 15 200"
      ></a-entity>
      <a-entity
        particle-system="preset: dust; color: #C2B280; particleCount: 50000; texture: ./assets/textures/red_sand.jpg; size: .2; velocityValue: -50 0 50; velocitySpread: 50 0 10;"
        position="-41.525 15 90"
      ></a-entity>
      <a-entity
        particle-system="preset: dust; color: #C2B280; particleCount: 50000; texture: ./assets/textures/red_sand.jpg; size: .2; velocityValue: -50 0 50; velocitySpread: 50 0 10;"
        position="-41.525 15 150"
      ></a-entity>

      <a-light type="ambient" color="#FFA500" intensity="1"></a-light>

      <a-entity
        gltf-model="#Rover"
        position="-18.157 1.7 -10"
        scale=".01 .01 .01"
        rotation="0 180 0"
      ></a-entity>

      <a-entity
        gltf-model="#robot"
        position="6.020 0.05 -13.680"
        scale=".008 .008 .008"
        rotation="0 170 0"
        animation="property: position; to: 6.020 0.05 -10; dur: 4000; easing: linear; dir: alternate; loop: true"
      ></a-entity>

      <a-entity gltf-model="#scene" position="0 0 -50" scale="1 1 1"> </a-entity
      ><a-entity
        gltf-model="#montagne"
        position="84.389 -0.5 350.407"
        scale="5 12.340 5"
      >
      </a-entity>
      <a-entity
        gltf-model="#montagne"
        position="270.885 -0.5 270.885"
        scale="5 12.340 5"
      >
      </a-entity
      ><a-entity
        gltf-model="#montagne"
        position="-118.240 -0.5 326.550"
        scale="5 12.340 5"
      >
      </a-entity
      ><a-entity
        gltf-model="#canyon"
        position="73.457 -1 -324.481"
        scale="45 45 20"
      >
      </a-entity>

      <a-entity random-rocks></a-entity>
      <a-entity
        random-cliffs="positions: -198.665 0 50, 60 0 -81.339, 120 0 40.668, -150 0 -49.037, 20.141 0 98.020; scales: 0.020 0.020 0.020, 0.01 0.01 0.01, 0.007 0.007 0.007, 0.006 0.006 0.006, 0.008 0.008 0.008"
      ></a-entity>
      <a-sound src="#audio" autoplay="true" loop="true"></a-sound>
      <script>
        AFRAME.registerComponent("random-rocks", {
          init: function () {
            for (let i = 0; i < 10; i++) { 
              let rock = document.createElement("a-entity");
              rock.setAttribute("gltf-model", "#rock");
              rock.setAttribute("position", {
                x: Math.random() * 300 - 100,
                y: 0,
                z: Math.random() * 300 - 100,
              });
              rock.setAttribute("scale", "2 3.2 1.6");
              rock.setAttribute("rotation", "0 0 90");
              rock.classList.add("collectible");
              rock.setAttribute("collect-item", "");
              this.el.appendChild(rock);
            }
          },
        });

        AFRAME.registerComponent("random-cliffs", {
          schema: {
            positions: { type: "array" },
            scales: { type: "array" },
          },
          init: function () {
            const positions = this.data.positions;
            const scales = this.data.scales;
            for (let i = 0; i < positions.length; i++) {
              let cliff = document.createElement("a-entity");
              cliff.setAttribute("gltf-model", "#cliff");
              cliff.setAttribute("position", positions[i]);
              cliff.setAttribute("scale", scales[i]);
              cliff.setAttribute("rotation", "0 0 0");
              this.el.appendChild(cliff);
            }
          },
        });

        AFRAME.registerComponent("collect-item", {
          init: function () {
            this.el.addEventListener("click", () => {
              this.el.parentNode.removeChild(this.el);
              console.log("Item collected!");
            });
          },
        });
      </script>
    </a-scene>
  </body>
</html>